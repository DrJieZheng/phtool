# Photometry Tool

By Dr/Prof Jie Zheng & Dr/Prof LinQiao Jiang

v0.1 2025-06-07

## 综述

编写一个工具，通过命令行可以实现较差测光数据处理的各个步骤。

## 调用模式

根源是提供一个Python包，在py环境中调用函数。通过终端 `py -m phtool command` 加上命令和参数的方式进行终端快捷调用，或者通过 `py -m phtool gui` 的方式调用GUI选择任务和参数（待开发）。

安装后会提供一个终端命令 phtool 直接调用。

## 命令

### biascombine

指定每一幅本底文件，以及合并方式，合并成一个本底文件。

### flatcombine

指定平场文件，以及合并后的本底，可选归一化模式与合并模式，合并成一个平场文件。

### darkcombine

（待开发）

合并暗流，指定每一幅暗流文件，以及合并方式，合并成一个暗流文件。

### imcorr

指定合并后的本底和平场，对科学图像进行改正。如果明确指定平场为1、本底为0，则相应不进行此项改正。可以选择开窗方式。如果不指定暗流，则不进行暗流改正。可以指定坏像元掩码文件。

默认根据头文件中的坐标字段（RA,DEC / CRVAL1,2 ）获得图像中心指向，也可以指定中心关键字，或者直接指定中心赤经赤纬。观测时间根据DATE-OBS和TIME-OBS，曝光时间依据EXPTIME或者EXPOSURE，或者指定时间关键字。然后计算JD/MJD，以及HJD-JD，BJD-TDB。如果fits头已经有JD/MJD/HJD/BJD则不计算。

### offset

计算各图像之间的平移量。

### find

调用 photutils 进行找源以及FWHM计算，输出星表，按照亮度排序，给出综合的FWHM预估值。

### align

图像对齐，相比offset，需要先找星，但是可以计算出旋转角等。目前是必须操作。

### phot

调用 photutils 进行测光，可选测光模式以及孔径。目标源可以通过直接在图像中指定，或者粗略xy指定，都不指定则根据find给出的结果进行全部测光。

### xyget

可视化模式选星。

### pick

根据实现的选星结果，从phot结果中挑出想要的星。

### diffcali

根据phot结果，进行不同指定的较差计算和绘图，可以指定目标。采用指定比较星的方式。

### imgexam

待开发

单纯的图像检查工具，展示图像，并且进行等高线、三维图、横截面、纵截面、PSF等绘制。


